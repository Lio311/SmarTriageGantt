name: Daily Gantt Task Report

on:
  schedule:
    # Runs every day at 08:00 AM Israel Time (05:00 AM UTC).
    # Days are defined as 0=Sunday through 6=Saturday.
    # The range '0-4' runs from Sunday to Thursday, skipping Friday (5) and Saturday (6).
    - cron: '0 5 * * 0-4'
  # Allows manual run from the GitHub UI
  workflow_dispatch:

jobs:
  build-and-send-report:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checks out the repository code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Sets up the Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. Installs the dependencies (pandas and openpyxl for .xlsx files)
      - name: Install dependencies
        run: pip install pandas openpyxl 

      # 4. Runs the Python script
      - name: Run Python script to send email
        env:
          # Passes the Secrets defined in GitHub to environment variables for the script
          GMAIL_USER: ${{ secrets.GMAIL_USER }}
          GMAIL_PASS: ${{ secrets.GMAIL_PASS }}
          RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        run: python send_gantt_summary.py
